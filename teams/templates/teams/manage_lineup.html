{% extends "base.html" %}
{% load static %}

{% block content %}
  <div class="container mt-4">
    <h2>Manage Lineups for {{ team.first_name }} {{ team.team_name }}</h2>

    <form method="post">
      {% csrf_token %}

      {# -- Lineup metadata -- #}
      <div class="mb-3">
        {{ form.as_p }}
      </div>

      {# -- Entries formset -- #}
      {{ formset.management_form }}
      <div class="row">
        {% for entry_form in formset %}
          <div class="col-md-6 mb-2">
            <div class="card p-3">
              <h5 class="card-title">Lineup Spot {{ forloop.counter }}</h5>
        
              <div class="mb-2">
                {{ entry_form.player.label_tag }}<br>
                {{ entry_form.player }}
              </div>
              <div class="mb-2">
                {{ entry_form.field_position.label_tag }}<br>
                {{ entry_form.field_position }}
              </div>
              {# You can hide the batting_order field if you want to lock it to forloop.counter, or keep it editable: #}
              <div class="mb-2">
                {{ entry_form.batting_order.label_tag }}<br>
                {{ entry_form.batting_order }}
              </div>
        
              {% if entry_form.instance.pk %}
                <div class="form-check mt-2">
                  {{ entry_form.DELETE }}
                  <label class="form-check-label">Delete this slot?</label>
                </div>
              {% endif %}
            </div>
          </div>
        {% endfor %}      
      </div>

      <button type="submit" class="btn btn-primary">Save Lineup</button>
    </form>

    <hr>

    <h3>Saved Lineups</h3>
    <ul class="list-group">
      {% for lu in team.lineups.all %}
        <li class="list-group-item d-flex justify-content-between align-items-center">
          {{ lu.name }}
          <a 
            href="{% url 'teams:edit_lineup' team_id=team.serial lineup_id=lu.id %}" 
            class="btn btn-sm btn-outline-secondary"
          >Edit</a>
        </li>
      {% empty %}
        <li class="list-group-item">No saved lineups yet.</li>
      {% endfor %}
    </ul>

    <a href="{% url 'teams:manage_lineup' team_id=team.serial %}" class="btn btn-link mt-3">
      + Create a new lineup
    </a>
  </div>
{% endblock %}
